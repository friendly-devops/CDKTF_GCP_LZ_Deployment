"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AttributeModel = exports.escapeAttributeName = void 0;
function escapeAttributeName(name) {
    // `self` and `build` doesn't work in as property name in Python
    if (name === "self" || name === "build")
        return `${name}Attribute`;
    // jsii can't handle `getFoo` properties, since it's incompatible with Java
    if (name.match(/^get[A-Za-z]+/))
        return name.replace("get", "fetch");
    // `equals` is a prohibited name in jsii
    if (name === "equals")
        return "equalTo";
    // `node` is already used by the Constructs base class
    if (name === "node")
        return "nodeAttribute";
    // `System` shadows built-in types in CSharp (see #1420)
    if (name === "system")
        return "systemAttribute";
    // `tfResourceType` is already used by resources to distinguish between different resource types
    if (name === "tfResourceType")
        return `${name}Attribute`;
    // `importFrom` has potential for common name collision with providers
    if (name === "importFrom")
        return `${name}Attribute`;
    // `move` could have common name collision with providers
    if (name === "moveTo")
        return `${name}Attribute`;
    // `software` attribute can be confused with the JSII Java runtime package (see #3115)
    if (name === "software")
        return `${name}Attribute`;
    return name;
}
exports.escapeAttributeName = escapeAttributeName;
class AttributeModel {
    constructor(options) {
        this.storageName = options.storageName;
        this._name = options.name;
        this.type = options.type;
        this.optional = options.optional;
        this.computed = options.computed;
        this.terraformName = options.terraformName;
        this.terraformFullName = options.terraformFullName;
        this._description = options.description;
        this.provider = options.provider;
        this.required = options.required;
        this.forcePlainGetterType = options.forcePlainGetterType;
    }
    get typeDefinition() {
        const optional = this.optional ? "?" : "";
        return `${this.name}${optional}: ${this.type.inputTypeDefinition}`;
    }
    get isAssignable() {
        return this.required || this.optional;
    }
    get isOptional() {
        return this.optional;
    }
    get isRequired() {
        return this.required;
    }
    get isProvider() {
        return this.provider;
    }
    get getterType() {
        let getterType = { _type: "plain" };
        if (this.forcePlainGetterType) {
            return getterType;
        }
        if (this.isProvider) {
            return getterType;
        }
        if (this.type.hasReferenceClass) {
            getterType = {
                _type: "stored_class",
            };
        }
        else if (this.computed &&
            !this.isAssignable &&
            (!this.type.isTokenizable || this.type.typeModelType === "map")) {
            getterType = {
                _type: "stored_class",
            };
        }
        return getterType;
    }
    get isStored() {
        return this.isAssignable;
    }
    get setterType() {
        if (!this.isStored) {
            return { _type: "none" };
        }
        if (this.getterType._type === "stored_class") {
            return {
                _type: "stored_class",
                type: this.type.inputTypeDefinition,
            };
        }
        return {
            _type: "set",
            type: `${this.type.inputTypeDefinition}${this.isProvider ? " | undefined" : ""}`,
        };
    }
    get name() {
        return AttributeModel.escapeName(this._name);
    }
    static escapeName(name) {
        return escapeAttributeName(name);
    }
    get description() {
        var _a;
        return (_a = this._description) === null || _a === void 0 ? void 0 : _a.replace(/'''/gi, "```");
    }
    getReferencedTypes(isConfigStruct) {
        const attTypeStruct = this.type.struct;
        if (!attTypeStruct) {
            return undefined;
        }
        const types = [];
        if (this.isAssignable) {
            types.push(attTypeStruct.name);
            types.push(attTypeStruct.mapperName);
            types.push(attTypeStruct.hclMapperName);
        }
        if (!attTypeStruct.isSingleItem &&
            (attTypeStruct.nestingMode === "list" ||
                attTypeStruct.nestingMode === "set")) {
            types.push(attTypeStruct.listName);
        }
        else if (attTypeStruct.nestingMode === "map") {
            types.push(attTypeStruct.mapName);
        }
        else if (attTypeStruct.nestingMode === "maplist") {
            types.push(attTypeStruct.mapListName);
        }
        else if (attTypeStruct.nestingMode === "mapset") {
            types.push(attTypeStruct.mapListName);
        }
        else if (attTypeStruct.nestingMode === "listmap") {
            types.push(attTypeStruct.listMapName);
        }
        else if (attTypeStruct.nestingMode === "setmap") {
            types.push(attTypeStruct.listMapName);
        }
        else if (attTypeStruct.nestingMode === "listlist" ||
            attTypeStruct.nestingMode === "listset" ||
            attTypeStruct.nestingMode === "setlist" ||
            attTypeStruct.nestingMode == "setset") {
            types.push(attTypeStruct.listListName);
        }
        else if (!isConfigStruct) {
            types.push(attTypeStruct.outputReferenceName);
        }
        // other types of nested collections aren't supported
        return types;
    }
}
exports.AttributeModel = AttributeModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXR0cmlidXRlLW1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXR0cmlidXRlLW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQXFDQSxTQUFnQixtQkFBbUIsQ0FBQyxJQUFZO0lBQzlDLGdFQUFnRTtJQUNoRSxJQUFJLElBQUksS0FBSyxNQUFNLElBQUksSUFBSSxLQUFLLE9BQU87UUFBRSxPQUFPLEdBQUcsSUFBSSxXQUFXLENBQUM7SUFDbkUsMkVBQTJFO0lBQzNFLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUM7UUFBRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3JFLHdDQUF3QztJQUN4QyxJQUFJLElBQUksS0FBSyxRQUFRO1FBQUUsT0FBTyxTQUFTLENBQUM7SUFDeEMsc0RBQXNEO0lBQ3RELElBQUksSUFBSSxLQUFLLE1BQU07UUFBRSxPQUFPLGVBQWUsQ0FBQztJQUM1Qyx3REFBd0Q7SUFDeEQsSUFBSSxJQUFJLEtBQUssUUFBUTtRQUFFLE9BQU8saUJBQWlCLENBQUM7SUFDaEQsZ0dBQWdHO0lBQ2hHLElBQUksSUFBSSxLQUFLLGdCQUFnQjtRQUFFLE9BQU8sR0FBRyxJQUFJLFdBQVcsQ0FBQztJQUN6RCxzRUFBc0U7SUFDdEUsSUFBSSxJQUFJLEtBQUssWUFBWTtRQUFFLE9BQU8sR0FBRyxJQUFJLFdBQVcsQ0FBQztJQUNyRCx5REFBeUQ7SUFDekQsSUFBSSxJQUFJLEtBQUssUUFBUTtRQUFFLE9BQU8sR0FBRyxJQUFJLFdBQVcsQ0FBQztJQUNqRCxzRkFBc0Y7SUFDdEYsSUFBSSxJQUFJLEtBQUssVUFBVTtRQUFFLE9BQU8sR0FBRyxJQUFJLFdBQVcsQ0FBQztJQUNuRCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUM7QUFwQkQsa0RBb0JDO0FBRUQsTUFBYSxjQUFjO0lBYXpCLFlBQVksT0FBOEI7UUFDeEMsSUFBSSxDQUFDLFdBQVcsR0FB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QUFLLEtBQUssRUFBRTtZQUM5QyxLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUNuQzthQUFNLElBQUksYUFBYSxDQUFDLFdBQVcsS0FBSyxTQUFTLEVBQUU7WUFDbEQsS0FBSyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDdkM7YUFBTSxJQUFJLGFBQWEsQ0FBQyxXQUFXLEtBQUssUUFBUSxFQUFFO1lBQ2pELEtBQUssQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ3ZDO2FBQU0sSUFBSSxhQUFhLENBQUMsV0FBVyxLQUFLLFNBQVMsRUFBRTtZQUNsRCxLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUN2QzthQUFNLElBQUksYUFBYSxDQUFDLFdBQVcsS0FBSyxRQUFRLEVBQUU7WUFDakQsS0FBSyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDdkM7YUFBTSxJQUNMLGFBQWEsQ0FBQyxXQUFXLEtBQUssVUFBVTtZQUN4QyxhQUFhLENBQUMsV0FBVyxLQUFLLFNBQVM7WUFDdkMsYUFBYSxDQUFDLFdBQVcsS0FBSyxTQUFTO1lBQ3ZDLGFBQWEsQ0FBQyxXQUFXLElBQUksUUFBUSxFQUNyQztZQUNBLEtBQUssQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ3hDO2FBQU0sSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUMxQixLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1NBQy9DO1FBQ0QscURBQXFEO1FBRXJELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztDQUNGO0FBNUpELHdDQTRKQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgSGFzaGlDb3JwLCBJbmNcbi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNUEwtMi4wXG5pbXBvcnQgeyBBdHRyaWJ1dGVUeXBlTW9kZWwgfSBmcm9tIFwiLi9hdHRyaWJ1dGUtdHlwZS1tb2RlbFwiO1xuXG5leHBvcnQgdHlwZSBHZXR0ZXJUeXBlID1cbiAgfCB7IF90eXBlOiBcInBsYWluXCIgfVxuICB8IHtcbiAgICAgIF90eXBlOiBcImFyZ3NcIjtcbiAgICAgIGFyZ3M6IHN0cmluZztcbiAgICAgIHJldHVyblR5cGU/OiBzdHJpbmc7XG4gICAgICByZXR1cm5TdGF0ZW1lbnQ6IHN0cmluZztcbiAgICB9XG4gIHwge1xuICAgICAgX3R5cGU6IFwic3RvcmVkX2NsYXNzXCI7XG4gICAgfTtcblxuZXhwb3J0IHR5cGUgU2V0dGVyVHlwZSA9XG4gIHwgeyBfdHlwZTogXCJub25lXCIgfVxuICB8IHsgX3R5cGU6IFwic2V0XCI7IHR5cGU6IHN0cmluZyB9XG4gIHwgeyBfdHlwZTogXCJwdXRcIjsgdHlwZTogc3RyaW5nIH1cbiAgfCB7IF90eXBlOiBcInN0b3JlZF9jbGFzc1wiOyB0eXBlOiBzdHJpbmcgfTtcblxuZXhwb3J0IGludGVyZmFjZSBBdHRyaWJ1dGVNb2RlbE9wdGlvbnMge1xuICBzdG9yYWdlTmFtZTogc3RyaW5nOyAvLyBwcml2YXRlIHByb3BlcnR5XG4gIG5hbWU6IHN0cmluZztcbiAgdHlwZTogQXR0cmlidXRlVHlwZU1vZGVsO1xuICBvcHRpb25hbDogYm9vbGVhbjtcbiAgY29tcHV0ZWQ6IGJvb2xlYW47XG4gIHRlcnJhZm9ybU5hbWU6IHN0cmluZztcbiAgdGVycmFmb3JtRnVsbE5hbWU6IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIGdldEF0dENhbGw/OiBzdHJpbmc7XG4gIHByb3ZpZGVyOiBib29sZWFuO1xuICByZXF1aXJlZDogYm9vbGVhbjtcbiAgZm9yY2VQbGFpbkdldHRlclR5cGU/OiBib29sZWFuOyAvLyB1c2VkIGZvciBza2lwcGluZyBhdHRyaWJ1dGUgdHlwZSBhdHRyaWJ1dGVzIHRoYXQgdXNlIHRoZSBTa2lwcGVkQXR0cmlidXRlVHlwZU1vZGVsIHdoaWNoIHJldHVybnMgYW4gaW50ZXJwb2xhdGlvbiBhbmQgaGFzIG5vIHN0b3JlZCB0eXBlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlc2NhcGVBdHRyaWJ1dGVOYW1lKG5hbWU6IHN0cmluZykge1xuICAvLyBgc2VsZmAgYW5kIGBidWlsZGAgZG9lc24ndCB3b3JrIGluIGFzIHByb3BlcnR5IG5hbWUgaW4gUHl0aG9uXG4gIGlmIChuYW1lID09PSBcInNlbGZcIiB8fCBuYW1lID09PSBcImJ1aWxkXCIpIHJldHVybiBgJHtuYW1lfUF0dHJpYnV0ZWA7XG4gIC8vIGpzaWkgY2FuJ3QgaGFuZGxlIGBnZXRGb29gIHByb3BlcnRpZXMsIHNpbmNlIGl0J3MgaW5jb21wYXRpYmxlIHdpdGggSmF2YVxuICBpZiAobmFtZS5tYXRjaCgvXmdldFtBLVphLXpdKy8pKSByZXR1cm4gbmFtZS5yZXBsYWNlKFwiZ2V0XCIsIFwiZmV0Y2hcIik7XG4gIC8vIGBlcXVhbHNgIGlzIGEgcHJvaGliaXRlZCBuYW1lIGluIGpzaWlcbiAgaWYgKG5hbWUgPT09IFwiZXF1YWxzXCIpIHJldHVybiBcImVxdWFsVG9cIjtcbiAgLy8gYG5vZGVgIGlzIGFscmVhZHkgdXNlZCBieSB0aGUgQ29uc3RydWN0cyBiYXNlIGNsYXNzXG4gIGlmIChuYW1lID09PSBcIm5vZGVcIikgcmV0dXJuIFwibm9kZUF0dHJpYnV0ZVwiO1xuICAvLyBgU3lzdGVtYCBzaGFkb3dzIGJ1aWx0LWluIHR5cGVzIGluIENTaGFycCAoc2VlICMxNDIwKVxuICBpZiAobmFtZSA9PT0gXCJzeXN0ZW1cIikgcmV0dXJuIFwic3lzdGVtQXR0cmlidXRlXCI7XG4gIC8vIGB0ZlJlc291cmNlVHlwZWAgaXMgYWxyZWFkeSB1c2VkIGJ5IHJlc291cmNlcyB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGRpZmZlcmVudCByZXNvdXJjZSB0eXBlc1xuICBpZiAobmFtZSA9PT0gXCJ0ZlJlc291cmNlVHlwZVwiKSByZXR1cm4gYCR7bmFtZX1BdHRyaWJ1dGVgO1xuICAvLyBgaW1wb3J0RnJvbWAgaGFzIHBvdGVudGlhbCBmb3IgY29tbW9uIG5hbWUgY29sbGlzaW9uIHdpdGggcHJvdmlkZXJzXG4gIGlmIChuYW1lID09PSBcImltcG9ydEZyb21cIikgcmV0dXJuIGAke25hbWV9QXR0cmlidXRlYDtcbiAgLy8gYG1vdmVgIGNvdWxkIGhhdmUgY29tbW9uIG5hbWUgY29sbGlzaW9uIHdpdGggcHJvdmlkZXJzXG4gIGlmIChuYW1lID09PSBcIm1vdmVUb1wiKSByZXR1cm4gYCR7bmFtZX1BdHRyaWJ1dGVgO1xuICAvLyBgc29mdHdhcmVgIGF0dHJpYnV0ZSBjYW4gYmUgY29uZnVzZWQgd2l0aCB0aGUgSlNJSSBKYXZhIHJ1bnRpbWUgcGFja2FnZSAoc2VlICMzMTE1KVxuICBpZiAobmFtZSA9PT0gXCJzb2Z0d2FyZVwiKSByZXR1cm4gYCR7bmFtZX1BdHRyaWJ1dGVgO1xuICByZXR1cm4gbmFtZTtcbn1cblxuZXhwb3J0IGNsYXNzIEF0dHJpYnV0ZU1vZGVsIHtcbiAgcHVibGljIHN0b3JhZ2VOYW1lOiBzdHJpbmc7IC8vIHByaXZhdGUgcHJvcGVydHlcbiAgcHJpdmF0ZSBfbmFtZTogc3RyaW5nO1xuICBwdWJsaWMgdHlwZTogQXR0cmlidXRlVHlwZU1vZGVsO1xuICBwdWJsaWMgb3B0aW9uYWw6IGJvb2xlYW47XG4gIHB1YmxpYyBjb21wdXRlZDogYm9vbGVhbjtcbiAgcHVibGljIHRlcnJhZm9ybU5hbWU6IHN0cmluZztcbiAgcHVibGljIHRlcnJhZm9ybUZ1bGxOYW1lOiBzdHJpbmc7XG4gIHByaXZhdGUgX2Rlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBwdWJsaWMgcHJvdmlkZXI6IGJvb2xlYW47XG4gIHB1YmxpYyByZXF1aXJlZDogYm9vbGVhbjtcbiAgcHVibGljIGZvcmNlUGxhaW5HZXR0ZXJUeXBlPzogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBBdHRyaWJ1dGVNb2RlbE9wdGlvbnMpIHtcbiAgICB0aGlzLnN0b3JhZ2VOYW1lID0gb3B0aW9ucy5zdG9yYWdlTmFtZTtcbiAgICB0aGlzLl9uYW1lID0gb3B0aW9ucy5uYW1lO1xuICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTtcbiAgICB0aGlzLm9wdGlvbmFsID0gb3B0aW9ucy5vcHRpb25hbDtcbiAgICB0aGlzLmNvbXB1dGVkID0gb3B0aW9ucy5jb21wdXRlZDtcbiAgICB0aGlzLnRlcnJhZm9ybU5hbWUgPSBvcHRpb25zLnRlcnJhZm9ybU5hbWU7XG4gICAgdGhpcy50ZXJyYWZvcm1GdWxsTmFtZSA9IG9wdGlvbnMudGVycmFmb3JtRnVsbE5hbWU7XG4gICAgdGhpcy5fZGVzY3JpcHRpb24gPSBvcHRpb25zLmRlc2NyaXB0aW9uO1xuICAgIHRoaXMucHJvdmlkZXIgPSBvcHRpb25zLnByb3ZpZGVyO1xuICAgIHRoaXMucmVxdWlyZWQgPSBvcHRpb25zLnJlcXVpcmVkO1xuICAgIHRoaXMuZm9yY2VQbGFpbkdldHRlclR5cGUgPSBvcHRpb25zLmZvcmNlUGxhaW5HZXR0ZXJUeXBlO1xuICB9XG5cbiAgcHVibGljIGdldCB0eXBlRGVmaW5pdGlvbigpIHtcbiAgICBjb25zdCBvcHRpb25hbCA9IHRoaXMub3B0aW9uYWwgPyBcIj9cIiA6IFwiXCI7XG4gICAgcmV0dXJuIGAke3RoaXMubmFtZX0ke29wdGlvbmFsfTogJHt0aGlzLnR5cGUuaW5wdXRUeXBlRGVmaW5pdGlvbn1gO1xuICB9XG5cbiAgcHVibGljIGdldCBpc0Fzc2lnbmFibGUoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWlyZWQgfHwgdGhpcy5vcHRpb25hbDtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgaXNPcHRpb25hbCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25hbDtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgaXNSZXF1aXJlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1aXJlZDtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgaXNQcm92aWRlcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5wcm92aWRlcjtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgZ2V0dGVyVHlwZSgpOiBHZXR0ZXJUeXBlIHtcbiAgICBsZXQgZ2V0dGVyVHlwZTogR2V0dGVyVHlwZSA9IHsgX3R5cGU6IFwicGxhaW5cIiB9O1xuXG4gICAgaWYgKHRoaXMuZm9yY2VQbGFpbkdldHRlclR5cGUpIHtcbiAgICAgIHJldHVybiBnZXR0ZXJUeXBlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzUHJvdmlkZXIpIHtcbiAgICAgIHJldHVybiBnZXR0ZXJUeXBlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnR5cGUuaGFzUmVmZXJlbmNlQ2xhc3MpIHtcbiAgICAgIGdldHRlclR5cGUgPSB7XG4gICAgICAgIF90eXBlOiBcInN0b3JlZF9jbGFzc1wiLFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgdGhpcy5jb21wdXRlZCAmJlxuICAgICAgIXRoaXMuaXNBc3NpZ25hYmxlICYmXG4gICAgICAoIXRoaXMudHlwZS5pc1Rva2VuaXphYmxlIHx8IHRoaXMudHlwZS50eXBlTW9kZWxUeXBlID09PSBcIm1hcFwiKVxuICAgICkge1xuICAgICAgZ2V0dGVyVHlwZSA9IHtcbiAgICAgICAgX3R5cGU6IFwic3RvcmVkX2NsYXNzXCIsXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiBnZXR0ZXJUeXBlO1xuICB9XG5cbiAgcHVibGljIGdldCBpc1N0b3JlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc0Fzc2lnbmFibGU7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHNldHRlclR5cGUoKTogU2V0dGVyVHlwZSB7XG4gICAgaWYgKCF0aGlzLmlzU3RvcmVkKSB7XG4gICAgICByZXR1cm4geyBfdHlwZTogXCJub25lXCIgfTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5nZXR0ZXJUeXBlLl90eXBlID09PSBcInN0b3JlZF9jbGFzc1wiKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBfdHlwZTogXCJzdG9yZWRfY2xhc3NcIixcbiAgICAgICAgdHlwZTogdGhpcy50eXBlLmlucHV0VHlwZURlZmluaXRpb24sXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBfdHlwZTogXCJzZXRcIixcbiAgICAgIHR5cGU6IGAke3RoaXMudHlwZS5pbnB1dFR5cGVEZWZpbml0aW9ufSR7XG4gICAgICAgIHRoaXMuaXNQcm92aWRlciA/IFwiIHwgdW5kZWZpbmVkXCIgOiBcIlwiXG4gICAgICB9YCxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGdldCBuYW1lKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIEF0dHJpYnV0ZU1vZGVsLmVzY2FwZU5hbWUodGhpcy5fbmFtZSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGVzY2FwZU5hbWUobmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gZXNjYXBlQXR0cmlidXRlTmFtZShuYW1lKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgZGVzY3JpcHRpb24oKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5fZGVzY3JpcHRpb24/LnJlcGxhY2UoLycnJy9naSwgXCJgYGBcIik7XG4gIH1cblxuICBwdWJsaWMgZ2V0UmVmZXJlbmNlZFR5cGVzKGlzQ29uZmlnU3RydWN0OiBib29sZWFuKTogc3RyaW5nW10gfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGF0dFR5cGVTdHJ1Y3QgPSB0aGlzLnR5cGUuc3RydWN0O1xuICAgIGlmICghYXR0VHlwZVN0cnVjdCkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBjb25zdCB0eXBlczogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmICh0aGlzLmlzQXNzaWduYWJsZSkge1xuICAgICAgdHlwZXMucHVzaChhdHRUeXBlU3RydWN0Lm5hbWUpO1xuICAgICAgdHlwZXMucHVzaChhdHRUeXBlU3RydWN0Lm1hcHBlck5hbWUpO1xuICAgICAgdHlwZXMucHVzaChhdHRUeXBlU3RydWN0LmhjbE1hcHBlck5hbWUpO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgICFhdHRUeXBlU3RydWN0LmlzU2luZ2xlSXRlbSAmJlxuICAgICAgKGF0dFR5cGVTdHJ1Y3QubmVzdGluZ01vZGUgPT09IFwibGlzdFwiIHx8XG4gICAgICAgIGF0dFR5cGVTdHJ1Y3QubmVzdGluZ01vZGUgPT09IFwic2V0XCIpXG4gICAgKSB7XG4gICAgICB0eXBlcy5wdXNoKGF0dFR5cGVTdHJ1Y3QubGlzdE5hbWUpO1xuICAgIH0gZWxzZSBpZiAoYXR0VHlwZVN0cnVjdC5uZXN0aW5nTW9kZSA9PT0gXCJtYXBcIikge1xuICAgICAgdHlwZXMucHVzaChhdHRUeXBlU3RydWN0Lm1hcE5hbWUpO1xuICAgIH0gZWxzZSBpZiAoYXR0VHlwZVN0cnVjdC5uZXN0aW5nTW9kZSA9PT0gXCJtYXBsaXN0XCIpIHtcbiAgICAgIHR5cGVzLnB1c2goYXR0VHlwZVN0cnVjdC5tYXBMaXN0TmFtZSk7XG4gICAgfSBlbHNlIGlmIChhdHRUeXBlU3RydWN0Lm5lc3RpbmdNb2RlID09PSBcIm1hcHNldFwiKSB7XG4gICAgICB0eXBlcy5wdXNoKGF0dFR5cGVTdHJ1Y3QubWFwTGlzdE5hbWUpO1xuICAgIH0gZWxzZSBpZiAoYXR0VHlwZVN0cnVjdC5uZXN0aW5nTW9kZSA9PT0gXCJsaXN0bWFwXCIpIHtcbiAgICAgIHR5cGVzLnB1c2goYXR0VHlwZVN0cnVjdC5saXN0TWFwTmFtZSk7XG4gICAgfSBlbHNlIGlmIChhdHRUeXBlU3RydWN0Lm5lc3RpbmdNb2RlID09PSBcInNldG1hcFwiKSB7XG4gICAgICB0eXBlcy5wdXNoKGF0dFR5cGVTdHJ1Y3QubGlzdE1hcE5hbWUpO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBhdHRUeXBlU3RydWN0Lm5lc3RpbmdNb2RlID09PSBcImxpc3RsaXN0XCIgfHxcbiAgICAgIGF0dFR5cGVTdHJ1Y3QubmVzdGluZ01vZGUgPT09IFwibGlzdHNldFwiIHx8XG4gICAgICBhdHRUeXBlU3RydWN0Lm5lc3RpbmdNb2RlID09PSBcInNldGxpc3RcIiB8fFxuICAgICAgYXR0VHlwZVN0cnVjdC5uZXN0aW5nTW9kZSA9PSBcInNldHNldFwiXG4gICAgKSB7XG4gICAgICB0eXBlcy5wdXNoKGF0dFR5cGVTdHJ1Y3QubGlzdExpc3ROYW1lKTtcbiAgICB9IGVsc2UgaWYgKCFpc0NvbmZpZ1N0cnVjdCkge1xuICAgICAgdHlwZXMucHVzaChhdHRUeXBlU3RydWN0Lm91dHB1dFJlZmVyZW5jZU5hbWUpO1xuICAgIH1cbiAgICAvLyBvdGhlciB0eXBlcyBvZiBuZXN0ZWQgY29sbGVjdGlvbnMgYXJlbid0IHN1cHBvcnRlZFxuXG4gICAgcmV0dXJuIHR5cGVzO1xuICB9XG59XG4iXX0=