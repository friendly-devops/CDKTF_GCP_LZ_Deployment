"use strict";
// Copyright (c) HashiCorp, Inc
// SPDX-License-Identifier: MPL-2.0
Object.defineProperty(exports, "__esModule", { value: true });
exports.replaceGoImports = exports.replaceCsharpImports = exports.replaceJavaImports = exports.replacePythonImports = void 0;
function replacePythonImports(code) {
    return code
        .split("\n")
        .map((line) => {
        // Replace from-import lines with lib
        const fromImportLibRegex = /from \.\.\.gen\.providers\.([^.]+)(?:\.lib)?\.(.*) import/;
        if (fromImportLibRegex.test(line)) {
            return line.replace(fromImportLibRegex, "from imports.$1.$2 import");
        }
        // Replace import lines with lib
        const importLibRegex = /import \.\.\.gen\.providers\.([^.]+)(?:\.lib)?\.(.*) as (.*)/;
        if (importLibRegex.test(line)) {
            return line.replace(importLibRegex, "import imports.$1.$2 as $3");
        }
        // Replace from-import lines
        if (line.startsWith("from ...gen.providers.")) {
            return line.replace("from ...gen.providers.", "from imports.");
        }
        // Replace import lines
        if (line.startsWith("import ...gen.providers.")) {
            return line.replace("import ...gen.providers.", "import imports.");
        }
        // Replace modules
        if (line.startsWith("import ...gen.modules.")) {
            return line.replace("import ...gen.modules.", "import imports.");
        }
        return line;
    })
        .join("\n");
}
exports.replacePythonImports = replacePythonImports;
function replaceJavaImports(code) {
    return code
        .split("\n")
        .map((line) => {
        // Replace using lines with lib and precices import
        const importWithLib = /import gen\.providers\.([^.]+)(?:\.lib)?\.([^.]+)\.(.*);/;
        const matchWithLib = line.match(importWithLib);
        if (matchWithLib) {
            const [, provider, resource, className] = matchWithLib;
            return `import imports.${provider}.${resource}.${className};`;
        }
        // Replace using lines
        const importWithoutLib = /import gen\.providers\.([^.]+)\.([^.]+)\.\*;/;
        const matchWithoutLib = line.match(importWithoutLib);
        if (matchWithoutLib) {
            const [, provider, resource] = matchWithoutLib;
            return `import imports.${provider}.${resource}.*;`;
        }
        // Replace using lines
        const importModules = /import gen\.modules\.(.+)\.\*;/;
        const importModulesMatch = line.match(importModules);
        if (importModulesMatch) {
            const [, module] = importModulesMatch;
            return `import imports.${module}.*;`;
        }
        return line;
    })
        .join("\n");
}
exports.replaceJavaImports = replaceJavaImports;
function replaceCsharpImports(code) {
    return code
        .split("\n")
        .map((line) => {
        // Replace using lines with lib
        const fromImportLibRegex = /using Gen\.Providers\.([^.]*)(?:\.Lib)?\.(.*);/;
        const match = line.match(fromImportLibRegex);
        if (match) {
            const [, provider, resource] = match;
            return `using ${lowercaseFirstChar(provider)}.${resource};`;
        }
        // Replace using lines
        if (line.startsWith("using Gen.Providers.")) {
            const importLine = line.replace("using Gen.Providers.", "");
            return `using ${importLine
                .substring(0, 1)
                .toLocaleLowerCase()}${importLine.substring(1)}`;
        }
        if (line.startsWith("using Gen.Modules.")) {
            const importLine = line.replace("using Gen.Modules.", "");
            return `using ${importLine}`;
        }
        return line;
    })
        .join("\n");
}
exports.replaceCsharpImports = replaceCsharpImports;
function replaceGoImports(code) {
    return code
        .split("\n")
        .map((line) => {
        // Replace using lines with lib
        const fromImportLibRegex = /import \"github.com\/aws-samples\/dummy\/gen\/providers\/([^\/]*)(?:\/lib)?\/(.*)\"/;
        const matchLib = line.match(fromImportLibRegex);
        if (matchLib) {
            const [, provider, resource] = matchLib;
            return `import "cdk.tf/go/stack/generated/${provider}/${resource}"`;
        }
        // Replace using lines
        const fromImportRegex = /import \"github.com\/aws-samples\/dummy\/gen\/providers\/([^\/]+)\/(.*)\"/;
        const match = line.match(fromImportRegex);
        if (match) {
            const [, provider, resource] = match;
            return `import "cdk.tf/go/stack/generated/${provider}/${resource}"`;
        }
        const importModulesRegex = /import (.*) \"github.com\/aws-samples\/dummy\/gen\/modules\/(.*)\"/;
        const matchModules = line.match(importModulesRegex);
        if (matchModules) {
            const [, name, module] = matchModules;
            return `import ${name} "cdk.tf/go/stack/generated/${module}"`;
        }
        return line;
    })
        .join("\n");
}
exports.replaceGoImports = replaceGoImports;
function lowercaseFirstChar(str) {
    return str.substring(0, 1).toLocaleLowerCase() + str.substring(1);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianNpaS1yb3NldHRhLXdvcmthcm91bmRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsianNpaS1yb3NldHRhLXdvcmthcm91bmRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwrQkFBK0I7QUFDL0IsbUNBQW1DOzs7QUFFbkMsU0FBZ0Isb0JBQW9CLENBQUMsSUFBWTtJQUMvQyxPQUFPLElBQUk7U0FDUixLQUFLLENBQUMsSUFBSSxDQUFDO1NBQ1gsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7UUFDWixxQ0FBcUM7UUFDckMsTUFBTSxrQkFBa0IsR0FDdEIsMkRBQTJELENBQUM7UUFDOUQsSUFBSSxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDakMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLGtCQUFrQixFQUFFLDJCQUEyQixDQUFDLENBQUM7U0FDdEU7UUFFRCxnQ0FBZ0M7UUFDaEMsTUFBTSxjQUFjLEdBQ2xCLDhEQUE4RCxDQUFDO1FBQ2pFLElBQUksY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUM3QixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLDRCQUE0QixDQUFDLENBQUM7U0FDbkU7UUFFRCw0QkFBNEI7UUFDNUIsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLHdCQUF3QixDQUFDLEVBQUU7WUFDN0MsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLHdCQUF3QixFQUFFLGVBQWUsQ0FBQyxDQUFDO1NBQ2hFO1FBQ0QsdUJBQXVCO1FBQ3ZCLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQywwQkFBMEIsQ0FBQyxFQUFFO1lBQy9DLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQywwQkFBMEIsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO1NBQ3BFO1FBRUQsa0JBQWtCO1FBQ2xCLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyx3QkFBd0IsQ0FBQyxFQUFFO1lBQzdDLE9B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QUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDaEIsQ0FBQztBQWpDRCw0Q0FpQ0M7QUFFRCxTQUFTLGtCQUFrQixDQUFDLEdBQVc7SUFDckMsT0FBTyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDcEUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgSGFzaGlDb3JwLCBJbmNcbi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNUEwtMi4wXG5cbmV4cG9ydCBmdW5jdGlvbiByZXBsYWNlUHl0aG9uSW1wb3J0cyhjb2RlOiBzdHJpbmcpIHtcbiAgcmV0dXJuIGNvZGVcbiAgICAuc3BsaXQoXCJcXG5cIilcbiAgICAubWFwKChsaW5lKSA9PiB7XG4gICAgICAvLyBSZXBsYWNlIGZyb20taW1wb3J0IGxpbmVzIHdpdGggbGliXG4gICAgICBjb25zdCBmcm9tSW1wb3J0TGliUmVnZXggPVxuICAgICAgICAvZnJvbSBcXC5cXC5cXC5nZW5cXC5wcm92aWRlcnNcXC4oW14uXSspKD86XFwubGliKT9cXC4oLiopIGltcG9ydC87XG4gICAgICBpZiAoZnJvbUltcG9ydExpYlJlZ2V4LnRlc3QobGluZSkpIHtcbiAgICAgICAgcmV0dXJuIGxpbmUucmVwbGFjZShmcm9tSW1wb3J0TGliUmVnZXgsIFwiZnJvbSBpbXBvcnRzLiQxLiQyIGltcG9ydFwiKTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVwbGFjZSBpbXBvcnQgbGluZXMgd2l0aCBsaWJcbiAgICAgIGNvbnN0IGltcG9ydExpYlJlZ2V4ID1cbiAgICAgICAgL2ltcG9ydCBcXC5cXC5cXC5nZW5cXC5wcm92aWRlcnNcXC4oW14uXSspKD86XFwubGliKT9cXC4oLiopIGFzICguKikvO1xuICAgICAgaWYgKGltcG9ydExpYlJlZ2V4LnRlc3QobGluZSkpIHtcbiAgICAgICAgcmV0dXJuIGxpbmUucmVwbGFjZShpbXBvcnRMaWJSZWdleCwgXCJpbXBvcnQgaW1wb3J0cy4kMS4kMiBhcyAkM1wiKTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVwbGFjZSBmcm9tLWltcG9ydCBsaW5lc1xuICAgICAgaWYgKGxpbmUuc3RhcnRzV2l0aChcImZyb20gLi4uZ2VuLnByb3ZpZGVycy5cIikpIHtcbiAgICAgICAgcmV0dXJuIGxpbmUucmVwbGFjZShcImZyb20gLi4uZ2VuLnByb3ZpZGVycy5cIiwgXCJmcm9tIGltcG9ydHMuXCIpO1xuICAgICAgfVxuICAgICAgLy8gUmVwbGFjZSBpbXBvcnQgbGluZXNcbiAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoXCJpbXBvcnQgLi4uZ2VuLnByb3ZpZGVycy5cIikpIHtcbiAgICAgICAgcmV0dXJuIGxpbmUucmVwbGFjZShcImltcG9ydCAuLi5nZW4ucHJvdmlkZXJzLlwiLCBcImltcG9ydCBpbXBvcnRzLlwiKTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVwbGFjZSBtb2R1bGVzXG4gICAgICBpZiAobGluZS5zdGFydHNXaXRoKFwiaW1wb3J0IC4uLmdlbi5tb2R1bGVzLlwiKSkge1xuICAgICAgICByZXR1cm4gbGluZS5yZXBsYWNlKFwiaW1wb3J0IC4uLmdlbi5tb2R1bGVzLlwiLCBcImltcG9ydCBpbXBvcnRzLlwiKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGxpbmU7XG4gICAgfSlcbiAgICAuam9pbihcIlxcblwiKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlcGxhY2VKYXZhSW1wb3J0cyhjb2RlOiBzdHJpbmcpIHtcbiAgcmV0dXJuIGNvZGVcbiAgICAuc3BsaXQoXCJcXG5cIilcbiAgICAubWFwKChsaW5lKSA9PiB7XG4gICAgICAvLyBSZXBsYWNlIHVzaW5nIGxpbmVzIHdpdGggbGliIGFuZCBwcmVjaWNlcyBpbXBvcnRcbiAgICAgIGNvbnN0IGltcG9ydFdpdGhMaWIgPVxuICAgICAgICAvaW1wb3J0IGdlblxcLnByb3ZpZGVyc1xcLihbXi5dKykoPzpcXC5saWIpP1xcLihbXi5dKylcXC4oLiopOy87XG4gICAgICBjb25zdCBtYXRjaFdpdGhMaWIgPSBsaW5lLm1hdGNoKGltcG9ydFdpdGhMaWIpO1xuICAgICAgaWYgKG1hdGNoV2l0aExpYikge1xuICAgICAgICBjb25zdCBbLCBwcm92aWRlciwgcmVzb3VyY2UsIGNsYXNzTmFtZV0gPSBtYXRjaFdpdGhMaWI7XG4gICAgICAgIHJldHVybiBgaW1wb3J0IGltcG9ydHMuJHtwcm92aWRlcn0uJHtyZXNvdXJjZX0uJHtjbGFzc05hbWV9O2A7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlcGxhY2UgdXNpbmcgbGluZXNcbiAgICAgIGNvbnN0IGltcG9ydFdpdGhvdXRMaWIgPSAvaW1wb3J0IGdlblxcLnByb3ZpZGVyc1xcLihbXi5dKylcXC4oW14uXSspXFwuXFwqOy87XG4gICAgICBjb25zdCBtYXRjaFdpdGhvdXRMaWIgPSBsaW5lLm1hdGNoKGltcG9ydFdpdGhvdXRMaWIpO1xuICAgICAgaWYgKG1hdGNoV2l0aG91dExpYikge1xuICAgICAgICBjb25zdCBbLCBwcm92aWRlciwgcmVzb3VyY2VdID0gbWF0Y2hXaXRob3V0TGliO1xuICAgICAgICByZXR1cm4gYGltcG9ydCBpbXBvcnRzLiR7cHJvdmlkZXJ9LiR7cmVzb3VyY2V9Lio7YDtcbiAgICAgIH1cblxuICAgICAgLy8gUmVwbGFjZSB1c2luZyBsaW5lc1xuICAgICAgY29uc3QgaW1wb3J0TW9kdWxlcyA9IC9pbXBvcnQgZ2VuXFwubW9kdWxlc1xcLiguKylcXC5cXCo7LztcbiAgICAgIGNvbnN0IGltcG9ydE1vZHVsZXNNYXRjaCA9IGxpbmUubWF0Y2goaW1wb3J0TW9kdWxlcyk7XG4gICAgICBpZiAoaW1wb3J0TW9kdWxlc01hdGNoKSB7XG4gICAgICAgIGNvbnN0IFssIG1vZHVsZV0gPSBpbXBvcnRNb2R1bGVzTWF0Y2g7XG4gICAgICAgIHJldHVybiBgaW1wb3J0IGltcG9ydHMuJHttb2R1bGV9Lio7YDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGxpbmU7XG4gICAgfSlcbiAgICAuam9pbihcIlxcblwiKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlcGxhY2VDc2hhcnBJbXBvcnRzKGNvZGU6IHN0cmluZykge1xuICByZXR1cm4gY29kZVxuICAgIC5zcGxpdChcIlxcblwiKVxuICAgIC5tYXAoKGxpbmUpID0+IHtcbiAgICAgIC8vIFJlcGxhY2UgdXNpbmcgbGluZXMgd2l0aCBsaWJcbiAgICAgIGNvbnN0IGZyb21JbXBvcnRMaWJSZWdleCA9XG4gICAgICAgIC91c2luZyBHZW5cXC5Qcm92aWRlcnNcXC4oW14uXSopKD86XFwuTGliKT9cXC4oLiopOy87XG4gICAgICBjb25zdCBtYXRjaCA9IGxpbmUubWF0Y2goZnJvbUltcG9ydExpYlJlZ2V4KTtcbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBjb25zdCBbLCBwcm92aWRlciwgcmVzb3VyY2VdID0gbWF0Y2g7XG4gICAgICAgIHJldHVybiBgdXNpbmcgJHtsb3dlcmNhc2VGaXJzdENoYXIocHJvdmlkZXIpfS4ke3Jlc291cmNlfTtgO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXBsYWNlIHVzaW5nIGxpbmVzXG4gICAgICBpZiAobGluZS5zdGFydHNXaXRoKFwidXNpbmcgR2VuLlByb3ZpZGVycy5cIikpIHtcbiAgICAgICAgY29uc3QgaW1wb3J0TGluZSA9IGxpbmUucmVwbGFjZShcInVzaW5nIEdlbi5Qcm92aWRlcnMuXCIsIFwiXCIpO1xuXG4gICAgICAgIHJldHVybiBgdXNpbmcgJHtpbXBvcnRMaW5lXG4gICAgICAgICAgLnN1YnN0cmluZygwLCAxKVxuICAgICAgICAgIC50b0xvY2FsZUxvd2VyQ2FzZSgpfSR7aW1wb3J0TGluZS5zdWJzdHJpbmcoMSl9YDtcbiAgICAgIH1cblxuICAgICAgaWYgKGxpbmUuc3RhcnRzV2l0aChcInVzaW5nIEdlbi5Nb2R1bGVzLlwiKSkge1xuICAgICAgICBjb25zdCBpbXBvcnRMaW5lID0gbGluZS5yZXBsYWNlKFwidXNpbmcgR2VuLk1vZHVsZXMuXCIsIFwiXCIpO1xuXG4gICAgICAgIHJldHVybiBgdXNpbmcgJHtpbXBvcnRMaW5lfWA7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBsaW5lO1xuICAgIH0pXG4gICAgLmpvaW4oXCJcXG5cIik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXBsYWNlR29JbXBvcnRzKGNvZGU6IHN0cmluZykge1xuICByZXR1cm4gY29kZVxuICAgIC5zcGxpdChcIlxcblwiKVxuICAgIC5tYXAoKGxpbmUpID0+IHtcbiAgICAgIC8vIFJlcGxhY2UgdXNpbmcgbGluZXMgd2l0aCBsaWJcbiAgICAgIGNvbnN0IGZyb21JbXBvcnRMaWJSZWdleCA9XG4gICAgICAgIC9pbXBvcnQgXFxcImdpdGh1Yi5jb21cXC9hd3Mtc2FtcGxlc1xcL2R1bW15XFwvZ2VuXFwvcHJvdmlkZXJzXFwvKFteXFwvXSopKD86XFwvbGliKT9cXC8oLiopXFxcIi87XG4gICAgICBjb25zdCBtYXRjaExpYiA9IGxpbmUubWF0Y2goZnJvbUltcG9ydExpYlJlZ2V4KTtcbiAgICAgIGlmIChtYXRjaExpYikge1xuICAgICAgICBjb25zdCBbLCBwcm92aWRlciwgcmVzb3VyY2VdID0gbWF0Y2hMaWI7XG4gICAgICAgIHJldHVybiBgaW1wb3J0IFwiY2RrLnRmL2dvL3N0YWNrL2dlbmVyYXRlZC8ke3Byb3ZpZGVyfS8ke3Jlc291cmNlfVwiYDtcbiAgICAgIH1cblxuICAgICAgLy8gUmVwbGFjZSB1c2luZyBsaW5lc1xuICAgICAgY29uc3QgZnJvbUltcG9ydFJlZ2V4ID1cbiAgICAgICAgL2ltcG9ydCBcXFwiZ2l0aHViLmNvbVxcL2F3cy1zYW1wbGVzXFwvZHVtbXlcXC9nZW5cXC9wcm92aWRlcnNcXC8oW15cXC9dKylcXC8oLiopXFxcIi87XG4gICAgICBjb25zdCBtYXRjaCA9IGxpbmUubWF0Y2goZnJvbUltcG9ydFJlZ2V4KTtcbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBjb25zdCBbLCBwcm92aWRlciwgcmVzb3VyY2VdID0gbWF0Y2g7XG4gICAgICAgIHJldHVybiBgaW1wb3J0IFwiY2RrLnRmL2dvL3N0YWNrL2dlbmVyYXRlZC8ke3Byb3ZpZGVyfS8ke3Jlc291cmNlfVwiYDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgaW1wb3J0TW9kdWxlc1JlZ2V4ID1cbiAgICAgICAgL2ltcG9ydCAoLiopIFxcXCJnaXRodWIuY29tXFwvYXdzLXNhbXBsZXNcXC9kdW1teVxcL2dlblxcL21vZHVsZXNcXC8oLiopXFxcIi87XG4gICAgICBjb25zdCBtYXRjaE1vZHVsZXMgPSBsaW5lLm1hdGNoKGltcG9ydE1vZHVsZXNSZWdleCk7XG4gICAgICBpZiAobWF0Y2hNb2R1bGVzKSB7XG4gICAgICAgIGNvbnN0IFssIG5hbWUsIG1vZHVsZV0gPSBtYXRjaE1vZHVsZXM7XG4gICAgICAgIHJldHVybiBgaW1wb3J0ICR7bmFtZX0gXCJjZGsudGYvZ28vc3RhY2svZ2VuZXJhdGVkLyR7bW9kdWxlfVwiYDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGxpbmU7XG4gICAgfSlcbiAgICAuam9pbihcIlxcblwiKTtcbn1cblxuZnVuY3Rpb24gbG93ZXJjYXNlRmlyc3RDaGFyKHN0cjogc3RyaW5nKSB7XG4gIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsIDEpLnRvTG9jYWxlTG93ZXJDYXNlKCkgKyBzdHIuc3Vic3RyaW5nKDEpO1xufVxuIl19